<!DOCTYPE html>
<html>
  <head>
    <title>JavaScript Network Graph</title>
    <style>
      html, body, #container {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <script src="jquery.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.10.0/js/anychart-core.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.10.0/js/anychart-graph.min.js"></script>
    <script src="https://cdn.anychart.com/releases/8.10.0/js/anychart-data-adapter.min.js"></script>


</head>
  <body>
    <div id=conceptscn class=conceptscn></div>
    <div id="container"></div>
    <script>
        
        /////////////////////////
        $(document).ready(function() {
            var cList = ["Protein", "Gene", "Site", "Enzyme", "Glycan", "Motif", 
                "Disease", "Species"];

            var chkboxes = "";
            for (var i in cList){
                var c = cList[i].toLowerCase();
                chkboxes += "<input type=checkbox class=concept value="+c+">" + cList[i];
                chkboxes += "&nbsp;&nbsp;&nbsp;";
            }
            var cn = "<table width=70% align=center border=1>";
            cn += "<tr><td>Select concept</td></tr>";
            cn += "<tr><td>"+chkboxes+"</td></tr>";
            cn += "</table>";

            $("#conceptscn").html(cn);
            var conceptList = [];
            updatePage(conceptList);
        });
        

        /////////////////////////////
        $(document).on('change', '.conceptscn', function (event) {
            event.preventDefault();
            var conceptList = [];
            $('.concept:checkbox:checked').each(function () {
                conceptList.push($(this).val());
            });
            updatePage(conceptList);
        });


        //////////////////////////////
        function updatePage(conceptList){
            $("#container").html("");
            var reqObj = {"conceptlist":conceptList};
            var jsonUrl = "https://api.dev.glygen.org//graph/getdata?query=";
            jsonUrl += JSON.stringify(reqObj);
            var xhr = new XMLHttpRequest();
            xhr.open("GET", jsonUrl, true);
            xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var data = JSON.parse(xhr.responseText);
                    //console.log(xhr.responseText);
                    drawGraph(data);
                }
            };
            xhr.send();
            
            return;
        }


        ///////////////////////////////
        function drawGraph(data){
            var chart = anychart.graph(data);
            
            //chart.title("Network Graph");
            chart.container("container").draw();
            chart.layout().iterationCount(1);
            chart.nodes().labels().enabled(true);
            
            // configure the labels of nodes
            chart.nodes().labels().format("{%id}");
            chart.nodes().labels().fontSize(16);
            //chart.nodes().labels().fontWeight(600);
            
            var labels = chart.labels();
            labels.enabled(true);
            labels.fontSize(15);
            labels.format('{%direction}');
            var config = {format: '{%direction}', fontSize: 10};
            chart.edges().labels(config);

            chart.edges().arrows({enabled: true,size:5,position: '20%'});

            return;
        }
    </script>
  </body>
</html>

